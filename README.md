# 건설 시뮬레이션 프로그램

BIM(Building Information Modeling)과 전통 방식을 비교하는 GPT-4 기반 멀티 에이전트 시뮬레이션

## 📋 개요

동일한 건설 프로젝트를 **BIM 방식**과 **전통 방식**으로 진행할 때의 차이를 정량적으로 분석하는 시뮬레이션 프로그램입니다.

### 주요 기능
- 180개 이슈 카드 (BIM 90개 + 전통 90개) 기반 시뮬레이션
- GPT-4 멀티 에이전트 회의 시스템 (건축주, 시공사)
- KPI 기반 이슈 발생 확률 계산
- 일정 지연 및 비용 증가 추적
- 전체 공기 동안의 상세 회의 로그 기록

## 🏗️ 프로젝트 구조

```
construction_simulation/
├── src/
│   ├── config/
│   │   ├── case_mapping.py         # 케이스(A~D) 및 KPI 매핑
│   │   └── project_context.py      # 프로젝트 컨텍스트 관리
│   ├── data/
│   │   └── issue_cards.py          # 이슈 카드 데이터 (180개)
│   ├── agents/
│   │   ├── base_agent.py           # 에이전트 베이스 클래스
│   │   ├── owner_agent.py          # 건축주 에이전트 (GPT-4)
│   │   └── contractor_agent.py     # 시공사 에이전트 (GPT-4)
│   ├── core/
│   │   ├── issue_manager.py        # 이슈 상태 관리
│   │   ├── agent_meeting.py        # GPT 에이전트 회의 진행
│   │   ├── probability_calculator.py  # KPI 기반 확률 계산
│   │   └── simulation_engine.py    # 시뮬레이션 엔진
│   └── utils/
│       └── llm_client.py           # OpenAI/Anthropic API 클라이언트
├── main.py                         # 메인 실행 파일
├── project_config.json             # 프로젝트 설정 파일
├── bim_issues_raw.json             # BIM 이슈 원본 데이터
├── traditional_issues_raw.json     # 전통 방식 이슈 원본 데이터
├── logs/                           # 회의 로그 저장
├── results/                        # 결과 요약 저장
└── README.md
```

## 🚀 실행 방법

### 1. 환경 설정

```bash
# 가상환경 생성 및 활성화
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 필요한 패키지 설치
pip install openai anthropic python-dotenv
```

### 2. API 키 설정

`.env` 파일 생성 후 API 키 입력:
```env
OPENAI_API_KEY=your_openai_api_key_here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
```

### 3. 프로젝트 설정

`project_config.json` 파일에서 프로젝트 정보 설정:

```json
{
  "프로젝트명": "청담동 근린생활시설 신축공사",
  "위치": "서울특별시 강남구 청담동 2-2",
  "location": "도심",
  "용도": "근린생활시설",
  "building_type": "상업",
  "연면적_제곱미터": 883.5,
  "연면적_평": 267.23,
  "총공사비_억원": 20.3,
  "계획공기_개월": 12,
  "계획공기_일수": 360,
  "용적률": 80,
  "ground_roughness": "C"
}
```

### 4. 시뮬레이션 실행

```bash
python main.py
```

## 📊 시뮬레이션 프로세스

### 1. 케이스 자동 결정

프로젝트 정보(위치 × 용적률)를 기반으로 케이스 A~D 자동 매핑:

```python
# 케이스 결정 로직
도심 + 용적률 ≥ 80%  → A (고밀도)
도심 + 용적률 ≥ 60%  → B (중밀도)
도심 + 용적률 < 60%   → C (저밀도)
외곽 + 용적률 ≥ 70%  → B (고밀도)
외곽 + 용적률 ≥ 50%  → C (중밀도)
외곽 + 용적률 < 50%   → D (저밀도)
```

**예시**: 청담동 프로젝트 (도심 + 용적률 80%) → **케이스 A**

### 2. KPI 자동 할당

케이스에 따라 KPI 값 자동 할당:

#### BIM 방식 KPI
- **WD (경고밀도)**: BIM 모델의 경고 개수 / 연면적 (개/㎡)
- **CD (충돌밀도)**: 간섭 탐지 개수 / 연면적 (개/㎡)
- **AF (속성 채움률)**: 속성 정보 완성도 (%)
- **PL (공정 연계도)**: 공정 관리 연계 비율 (%)

#### 전통 방식 KPI
- **RR (재시공률)**: 재작업 발생 비율 (%)
- **SR (안전사고 발생률)**: 안전사고 건수 / 100명당 (건)
- **CR (공정 지연률)**: 계획 대비 지연 발생 비율 (%)
- **FC (설계 변경 빈도)**: 변경 지시 건수 / 월 (건)

#### 케이스 A KPI 값 (청담동 프로젝트)
```python
BIM: WD=0.5, CD=0.17, AF=24.75, PL=13.2
전통: RR=0.2, SR=0.54, CR=2.48, FC=1.32
```

### 3. 매일 시뮬레이션 루프

```
for day in range(목표공기):
    1. 현재 공정률 계산 (day / 목표공기)
    2. 공정률 범위에서 발생 가능한 이슈 필터링
    3. KPI 기반 확률 계산 → 이슈 발생 여부 결정
    4. 진행 중인 이슈 상태 업데이트 (진행률 증가)
    5. GPT 에이전트 회의 진행
       - 건축주 GPT 의견 (우선순위, 우려도, 자원 경쟁)
       - 시공사 GPT 의견 (현장 평가, 공간 간섭, 작업 순서)
       - 심각도 평가 (지연 주수, 비용 증가율)
       - 해결 방안 제안 (정상 공정 vs 인력 증투)
       - 건축주 최종 선택
    6. 선택된 방안에 따라 지연/비용 누적
    7. 회의 로그 및 이슈 상태 기록
```

## 🎯 핵심 기능

### 1. KPI 기반 이슈 발생 확률 계산

```python
# 확률 계산 공식
최종확률 = 기본확률 × (1 + KPI위험도 조정)

# KPI위험도 = Σ(정규화된KPI값 × 가중치) / Σ가중치
# 정규화: 각 KPI를 0~1 범위로 변환 (높을수록 위험)

# 전통 방식은 위험 증폭 (1.2배)
if method == "TRADITIONAL":
    multiplier *= 1.2
```

**예시**:
```
이슈: "BIM 모델 간섭 발견"
기본 발생확률: 20%
가중치: WD=0.2, CD=0.6, AF=0.1, PL=0.1
KPI 값: WD=0.5, CD=0.17, AF=24.75, PL=13.2

→ 정규화 후 위험도 계산
→ 최종 발생 확률: 약 18.5%
```

### 2. 이슈 상태 관리

각 이슈는 다음 상태를 가집니다:

- **대기중**: 발생했으나 아직 착수하지 않음
- **해결중**: 현재 작업 진행 중 (진행률 0~100%)
- **해결완료**: 100% 완료
- **보류**: 다른 이슈 의존으로 대기

### 3. GPT 에이전트 회의 시스템

#### 건축주 에이전트 (Owner Agent)
- 비용과 일정 중심의 의사결정
- 우선순위: 안전 > 품질 > 일정 > 비용
- 현재 진행 중인 이슈와의 자원 경쟁 분석
- 추천 착수 시점 결정 (즉시/대기/조건부)

**출력 예시**:
```json
{
  "concern_level": "높음",
  "priority": "일정 준수",
  "opinion": "이 이슈는 현재 진행 중인 3개 이슈와 자원 경쟁이 있으며...",
  "severity_assessment": 8,
  "budget_tolerance": "1.5%",
  "resource_conflict": "인력 30% 중복",
  "recommended_timing": "조건부착수"
}
```

#### 시공사 에이전트 (Contractor Agent)
- 현장 실행 가능성 중심 평가
- 공간 간섭, 작업 순서, 하도급 가용성 분석
- 해결 방안 제안 (정상 공정 vs 인력 증투)

**출력 예시**:
```json
{
  "field_assessment": "현장 여건 평가 결과 공간 간섭 있음",
  "opinion": "현재 진행 중인 이슈와 작업 공간 30% 중복...",
  "resource_conflict_detail": "인력 8명 필요, 현재 5명만 가용",
  "space_interference": "30%",
  "safety_risk": "보통",
  "recommended_sequence": "선행이슈_완료후",
  "subcontractor_availability": "3일 후 투입 가능"
}
```

### 4. 해결 방안 제안 및 선택

시공사가 2가지 해결 방안 제안:

1. **정상 공정 (SOL-C1)**
   - 시간: 원래 예상 시간대로
   - 비용: 최소 비용
   - 품질: 높음
   - 리스크: 낮음

2. **인력 증투 신속처리 (SOL-C2)**
   - 시간: 약 60% 단축
   - 비용: 약 2배
   - 품질: 보통
   - 리스크: 보통

건축주가 프로젝트 상황을 고려하여 최종 선택

### 5. 회의 로그 기록

전체 공기 동안의 모든 회의를 1개 파일에 상세 기록:

- 매일 진행률 및 이슈 현황
- 각 이슈별 GPT 의견 전문
- 심각도 평가 결과
- 제안된 해결 방안들
- 최종 선택 및 근거

상세 구조는 [LOG_STRUCTURE.md](LOG_STRUCTURE.md) 참조

## 📈 결과 분석

### 생성되는 파일

```
logs/
├── bim_meetings_YYYYMMDD_HHMMSS.json          # BIM 전체 회의 로그
├── bim_issues_YYYYMMDD_HHMMSS.json            # BIM 이슈 목록
├── traditional_meetings_YYYYMMDD_HHMMSS.json  # 전통 전체 회의 로그
└── traditional_issues_YYYYMMDD_HHMMSS.json    # 전통 이슈 목록

results/
└── comparison_report_YYYYMMDD_HHMMSS.json     # 비교 리포트
```

### 출력 예시

```
【일정 비교】
  BIM:  128.8일 지연
  전통: 164.1일 지연
  개선: 35.3일 단축 (21.5%)

【비용 비교】
  BIM:  6.21% 증가
  전통: 10.93% 증가
  개선: 4.72%p 절감 (43.2%)

【이슈 발생 비교】
  BIM:  76개 발생
  전통: 85개 발생
  개선: 9개 감소 (10.6%)
```

## 🔧 커스터마이징

### 1. 새로운 프로젝트 실행

`project_config.json` 파일만 수정하면 됩니다:

```json
{
  "프로젝트명": "신규 프로젝트",
  "location": "외곽",           # 도심 또는 외곽
  "용적률": 60,                # 케이스 결정에 사용
  "연면적_제곱미터": 5000,
  "총공사비_억원": 50,
  "계획공기_일수": 540,         # 18개월 = 540일
  "building_type": "주거",     # 상업/주거/공업/복합
  "ground_roughness": "B"
}
```

### 2. KPI 값 조정

`src/config/case_mapping.py`에서 케이스별 KPI 값 수정:

```python
BIM_KPI_VALUES = {
    "A": {"WD": 0.5, "CD": 0.17, "AF": 24.75, "PL": 13.2},
    "B": {"WD": 0.33, "CD": 0.11, "AF": 16.5, "PL": 8.8},
    # ...
}
```

### 3. 이슈 추가/수정

`src/data/issue_cards.py`에서 이슈 카드 데이터 수정:

```python
{
    "ID": "B091",
    "이슈명": "신규 이슈",
    "카테고리": "시공",
    "발생단계": "시공",
    "공정률": "25-75",           # 발생 가능 공정률 범위
    "심각도": "S2",
    "발생확률(%)": 15,
    "지연(주)_Min": 1,
    "지연(주)_Max": 3,
    "비용증가(%)_Min": 0.2,
    "비용증가(%)_Max": 0.6,
    "가중치": {                  # KPI 가중치
        "WD": 0.3,
        "CD": 0.4,
        "AF": 0.2,
        "PL": 0.1,
    },
    "설명": "이슈 설명"
}
```

### 4. 에이전트 프롬프트 수정

`src/agents/owner_agent.py` 또는 `contractor_agent.py`에서 GPT 시스템 프롬프트 수정 가능

## 💡 시스템 특징

### 회의 현실화 노력

이 프로젝트의 핵심은 **실제 건설 현장 회의를 최대한 현실적으로 재현**하는 것입니다:

1. **자원 경쟁 고려**
   - 진행 중인 이슈들이 인력, 자재, 공간을 두고 경쟁
   - 신규 이슈 발생 시 기존 이슈와의 충돌 분석

2. **작업 순서 결정**
   - 공간 간섭 분석 (같은 구역 작업 불가)
   - 선후행 관계 고려 (마감재 전 배관 완료 필수)

3. **현장 제약 반영**
   - 하도급 업체 가용성
   - 날씨, 민원 등 외부 요인
   - 안전 리스크 평가

4. **실무 의사결정 프로세스**
   - 건축주: 비용/일정/품질 균형
   - 시공사: 현장 실행 가능성
   - 양측 협의 후 최종 결정

### 데이터 무결성

- KPI 값은 실제 엑셀 데이터에서 추출하여 하드코딩
- 180개 이슈 카드는 외부 JSON 파일에서 로드
- 케이스 매핑 로직은 철저한 검증 완료

## 📝 기술 스택

- Python 3.8+
- OpenAI GPT-4 API (에이전트 회의)
- Anthropic Claude API (선택적)
- JSON 기반 데이터 관리

## 📄 관련 문서

- [LOG_STRUCTURE.md](LOG_STRUCTURE.md) - 로그 파일 구조 상세 설명

## 🤝 기여

이슈 및 PR 환영합니다!

## 📄 라이센스

MIT License
